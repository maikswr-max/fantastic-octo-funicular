{
  "name": "Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ®-Î¼ÎµÎ»Î­Ï„Î·",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.2.4",
    "react-dom": "^19.2.4",
    "recharts": "^3.7.0",
    "@google/genai": "^1.38.0"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}

export const translations = {
  el: {
    brand: "Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎœÎµÎ»Î­Ï„Î·",
    nav: {
      dashboard: "Î‘ÏÏ‡Î¹ÎºÎ®",
      mainPoints: "ÎšÏÏÎ¹Î± Î£Î·Î¼ÎµÎ¯Î±",
      talks: "ÎŸÎ¼Î¹Î»Î¯ÎµÏ‚",
      shepherding: "Î Î¿Î¹Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î•Ï€Î¹ÏƒÎºÎ­ÏˆÎµÎ¹Ï‚",
      starts: "ÎÎµÎºÎ¹Î½Î®Î¼Î±Ï„Î±"
    },
    privacy: {
      title: "Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î‘Ï€Î¿ÏÏÎ®Ï„Î¿Ï…",
      desc: "Î¤Î¿Ï€Î¹ÎºÎ® Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·. Î— ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± AI ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¿Î´Î¹ÎºÎ®."
    },
    header: {
      session: "Î•Î½ÎµÏÎ³Î® Î£Ï…Î½ÎµÎ´ÏÎ¯Î±",
      sync: "Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ DB: OK",
      engine: "ÎœÎ·Ï‡Î±Î½Î® Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ®Ï‚ ÎÎ¿Î·Î¼Î¿ÏƒÏÎ½Î·Ï‚ v1.0",
      saving: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...",
      saved: "Î£ÏÎ¸Î·ÎºÎµ",
      error: "Î£Ï†Î¬Î»Î¼Î±"
    },
    translator: {
      title: "AI ÎœÎµÏ„Î±Ï†ÏÎ±ÏƒÏ„Î®Ï‚",
      placeholder: "Î Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³Î®ÏƒÏ„Îµ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î³Î¹Î± Î¼ÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·...",
      button: "ÎœÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·",
      translating: "ÎœÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·...",
      copy: "Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®",
      copied: "Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ!",
      error: "Î£Ï†Î¬Î»Î¼Î± Î¼ÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·Ï‚"
    },
    assignments: {
      title: "Î•Ï€ÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î¿Î¹ Î”Î¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯",
      addBtn: "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î´Î¹Î¿ÏÎ¹ÏƒÎ¼Î¿Ï",
      label: "Î”Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚",
      date: "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±",
      meeting: "Î£Ï…Î½Î¬Î¸ÏÎ¿Î¹ÏƒÎ·",
      wednesday: "Î¤ÎµÏ„Î¬ÏÏ„Î·",
      sunday: "ÎšÏ…ÏÎ¹Î±ÎºÎ®",
      save: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·",
      noAssignments: "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î´Î¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯."
    },
    dashboard: {
      empty: "Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÏƒÏ…Î»Î»ÎµÏ‡Î¸ÎµÎ¯ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±ÎºÏŒÎ¼Î±.",
      emptyDesc: "Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½Î±Î»ÏÏƒÎµÎ¹Ï‚ AI.",
      entries: "Î•Î³Î³ÏÎ±Ï†Î­Ï‚",
      distribution: "ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹ÎºÎ® ÎšÎ±Ï„Î±Î½Î¿Î¼Î®",
      timeline: "Î§ÏÎ¿Î½Î¿Î»ÏŒÎ¹Î¿ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚",
      welcome: "ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î· ÎœÎµÎ»Î­Ï„Î· ÏƒÎ±Ï‚",
      controlCenter: "ÎšÎ•ÎÎ¤Î¡ÎŸ Î•Î›Î•Î“Î§ÎŸÎ¥",
      categories: {
        verses: "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î´Î±Ï†Î¯Ï‰Î½",
        gem: "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î ÎµÏ„ÏÎ±Î´Î¹Î¿Ï",
        study: "Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎœÎµÎ»Î­Ï„Î·",
        files: "Î±ÏÏ‡ÎµÎ¯Î±"
      }
    },
    add: {
      title: "Î¤ÏÎ¿Ï†Î¿Î´Î¿ÏƒÎ¯Î± ÎœÎµÎ»Î­Ï„Î·Ï‚",
      desc: "Î Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³Î®ÏƒÏ„Îµ Î¼Î¹Î± ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ· Î® Ï„ÏÎ±Î²Î®Î¾Ï„Îµ Î¼Î¹Î± Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±. Î¤Î¿ Gemini Î¸Î± Ï„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.",
      placeholder: "Î¤Î¹ Î¸Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ ÏƒÎ®Î¼ÎµÏÎ±;",
      analyzing: "Î‘Î½Î¬Î»Ï…ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...",
      submit: "Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½",
      cancel: "Î†ÎºÏ…ÏÎ¿",
      expand: "Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·",
      collapse: "Î£ÏÎ¼Ï€Ï„Ï…Î¾Î·",
      deleteConfirm: "Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ±Ï†ÎµÎ¯;",
      ok: "OK"
    },
    feed: {
      empty: "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±.",
      searchPlaceholder: "Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ ÏƒÏ„Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Î³ÏÎ¬Ï†Î·Î¼Î± Î³Î½ÏÏƒÎ·Ï‚..."
    },
    sentiments: {
      positive: "Î˜ÎµÏ„Î¹ÎºÏŒ",
      neutral: "ÎŸÏ…Î´Î­Ï„ÎµÏÎ¿",
      negative: "Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒ",
      important: "Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ"
    },
    alerts: {
      storageFull: "Î— Î¼Î½Î®Î¼Î· Ï„Î¿Ï… browser Î³Î­Î¼Î¹ÏƒÎµ! Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¹Î±Î³ÏÎ¬ÏˆÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎµÏ‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚.",
      importSuccess: "Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½!",
      importError: "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï….",
      processingError: "Î£Ï†Î¬Î»Î¼Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.",
      cameraError: "Î‘Î´Ï…Î½Î±Î¼Î¯Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ±."
    }
  },
  en: {
    brand: "Personal Study",
    nav: {
      dashboard: "Home",
      mainPoints: "Main Points",
      talks: "Talks",
      shepherding: "Shepherding Visits",
      starts: "Starts"
    },
    privacy: {
      title: "Privacy Mode",
      desc: "Local storage enabled. All AI processing is transient."
    },
    header: {
      session: "Session Active",
      sync: "Local DB Sync: OK",
      engine: "Personal Intelligence Engine v1.0",
      saving: "Saving...",
      saved: "Saved",
      error: "Error"
    },
    translator: {
      title: "AI Translator",
      placeholder: "Type text to translate...",
      button: "Translate",
      translating: "Translating...",
      copy: "Copy",
      copied: "Copied!",
      error: "Translation error"
    },
    assignments: {
      title: "Upcoming Assignments",
      addBtn: "Add assignment",
      label: "Assignment",
      date: "Date",
      meeting: "Meeting",
      wednesday: "Wednesday",
      sunday: "Sunday",
      save: "Save",
      noAssignments: "No assignments scheduled."
    },
    dashboard: {
      empty: "No intelligence gathered yet.",
      emptyDesc: "Add personal data to see AI-driven insights.",
      entries: "Entries",
      distribution: "Categorical Distribution",
      timeline: "Activity Timeline",
      welcome: "Welcome to your Study",
      controlCenter: "CONTROL CENTER",
      categories: {
        verses: "Add Verses",
        gem: "Add Gem",
        study: "Personal Study",
        files: "files"
      }
    },
    add: {
      title: "Feed Your Vault",
      desc: "Type a note, document detail, or snap a photo. Gemini will categorize it automatically.",
      placeholder: "What shall we add today?",
      analyzing: "Analyzing Intelligence...",
      submit: "Integrate Data",
      cancel: "Cancel",
      expand: "Expand",
      collapse: "Collapse",
      deleteConfirm: "Are you sure you want to delete this?",
      ok: "OK"
    },
    feed: {
      empty: "No entries found in this category.",
      searchPlaceholder: "Query your personal knowledge graph..."
    },
    sentiments: {
      positive: "Positive",
      neutral: "Neutral",
      negative: "Negative",
      important: "Important"
    },
    alerts: {
      storageFull: "Storage full! Please delete some entries or use smaller images.",
      importSuccess: "Data imported successfully!",
      importError: "Error importing backup file.",
      processingError: "Error processing your data. Please try again.",
      cameraError: "Unable to access camera."
    }
  },
  es: {
    brand: "Estudio Personal",
    nav: {
      dashboard: "Inicio",
      mainPoints: "Puntos Clave",
      talks: "Discursos",
      shepherding: "Visitas de Pastoreo",
      starts: "Comienzos"
    },
    privacy: {
      title: "Modo Privacidad",
      desc: "Almacenamiento local. El procesamiento de IA es transitorio."
    },
    header: {
      session: "SesiÃ³n Activa",
      sync: "SincronizaciÃ³n DB: OK",
      engine: "Motor de Inteligencia Personal v1.0",
      saving: "Guardando...",
      saved: "Guardado",
      error: "Error"
    },
    translator: {
      title: "Traductor AI",
      placeholder: "Escriba texto para traducir...",
      button: "Traducir",
      translating: "Traduciendo...",
      copy: "Copiar",
      copied: "Â¡Copiado!",
      error: "Error de traducciÃ³n"
    },
    assignments: {
      title: "PrÃ³ximas Asignaciones",
      addBtn: "AÃ±adir asignaciÃ³n",
      label: "AsignaciÃ³n",
      date: "Fecha",
      meeting: "ReuniÃ³n",
      wednesday: "MiÃ©rcoles",
      sunday: "Domingo",
      save: "Guardar",
      noAssignments: "No hay asignaciones programadas."
    },
    dashboard: {
      empty: "AÃºn no se ha recopilado inteligencia.",
      emptyDesc: "Agregue datos personales para ver anÃ¡lisis de IA.",
      entries: "Entradas",
      distribution: "DistribuciÃ³n CategÃ³rica",
      timeline: "CronologÃ­a de Actividad",
      welcome: "Bienvenido a su Estudio",
      controlCenter: "CENTRO DE CONTROL",
      categories: {
        verses: "AÃ±adir VersÃ­culos",
        gem: "AÃ±adir Gema",
        study: "Estudio Personal",
        files: "archivos"
      }
    },
    add: {
      title: "Alimentar su BÃ³veda",
      desc: "Escriba una nota o tome una foto. Gemini lo categorizarÃ¡ automÃ¡ticamente.",
      placeholder: "Â¿QuÃ© agregaremos hoy?",
      analyzing: "Analizando Inteligencia...",
      submit: "Integrar Datos",
      cancel: "Cancelar",
      expand: "Expandir",
      collapse: "Contraer",
      deleteConfirm: "Â¿EstÃ¡ seguro de que desea eliminar esto?",
      ok: "OK"
    },
    feed: {
      empty: "No se encontraron entradas en esta categorÃ­a.",
      searchPlaceholder: "Consulte su grÃ¡fico de conocimiento personal..."
    },
    sentiments: {
      positive: "Positivo",
      neutral: "Neutral",
      negative: "Negativo",
      important: "Importante"
    },
    alerts: {
      storageFull: "Â¡Memoria llena! Elimine algunas entradas o use imÃ¡genes mÃ¡s pequeÃ±as.",
      importSuccess: "Â¡Datos importados con Ã©xito!",
      importError: "Error al importar el archivo de respaldo.",
      processingError: "Error al procesar sus datos. IntÃ©ntelo de nuevo.",
      cameraError: "No se pudo acceder a la cÃ¡mara."
    }
  },
  it: {
    brand: "Studio Personale",
    nav: {
      dashboard: "Home",
      mainPoints: "Punti Chiave",
      talks: "Discorsi",
      shepherding: "Visite Pastorali",
      starts: "Inizi"
    },
    privacy: {
      title: "ModalitÃ  Privacy",
      desc: "Archiviazione locale. Il processamento AI Ã¨ transitorio."
    },
    header: {
      session: "Sessione Attiva",
      sync: "Sincronizzazione DB: OK",
      engine: "Motore di Intelligenza Personale v1.0",
      saving: "Salvataggio...",
      saved: "Salvato",
      error: "Errore"
    },
    translator: {
      title: "Traduttore AI",
      placeholder: "Scrivi il testo da tradurre...",
      button: "Traduci",
      translating: "Traduzione...",
      copy: "Copia",
      copied: "Copiato!",
      error: "Errore di traduzione"
    },
    assignments: {
      title: "Prossimi Incarichi",
      addBtn: "Aggiungi incarico",
      label: "Incarico",
      date: "Data",
      meeting: "Adunanza",
      wednesday: "MercoledÃ¬",
      sunday: "Domenica",
      save: "Salva",
      noAssignments: "Nessun incarico in programma."
    },
    dashboard: {
      empty: "Nessuna informazione raccolta.",
      emptyDesc: "Aggiungi dati per vedere le analisi AI.",
      entries: "Voci",
      distribution: "Distribuzione Categorie",
      timeline: "Cronologia AttivitÃ ",
      welcome: "Benvenuto nel tuo Studio",
      controlCenter: "CENTRO DI CONTROLLO",
      categories: {
        verses: "Aggiungi Versetti",
        gem: "Aggiungi Gemma",
        study: "Studio Personale",
        files: "file"
      }
    },
    add: {
      title: "Alimenta il tuo Vault",
      desc: "Scrivi una nota o scatta una foto. Gemini la categorizzerÃ  automaticamente.",
      placeholder: "Cosa aggiungiamo oggi?",
      analyzing: "Analisi in corso...",
      submit: "Integra Dati",
      cancel: "Annulla",
      expand: "Espandi",
      collapse: "Comprimi",
      deleteConfirm: "Sei sicuro di voler eliminare?",
      ok: "OK"
    },
    feed: {
      empty: "Nessuna voce trovata in questa categoria.",
      searchPlaceholder: "Cerca nel tuo grafico della conoscenza..."
    },
    sentiments: {
      positive: "Positivo",
      neutral: "Neutro",
      negative: "Negativo",
      important: "Importante"
    },
    alerts: {
      storageFull: "Memoria piena! Elimina alcune voci.",
      importSuccess: "Dati importati con successo!",
      importError: "Errore durante l'importazione.",
      processingError: "Errore di elaborazione. Riprova.",
      cameraError: "Impossibile accedere alla fotocamera."
    }
  }
};
{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}
export interface PersonalDataEntry {
  id: string;
  timestamp: number;
  rawContent: string;
  summary: string;
  category: string;
  tags: string[];
  sentiment: 'positive' | 'neutral' | 'negative' | 'important';
  confidence: number;
  imageUrl?: string;
}

export interface Assignment {
  id: string;
  text: string;
  date: string;
  meeting: 'Î¤ÎµÏ„Î¬ÏÏ„Î·' | 'ÎšÏ…ÏÎ¹Î±ÎºÎ®';
}

export interface CategoryStats {
  name: string;
  count: number;
  color: string;
}

export enum AppView {
  DASHBOARD = 'DASHBOARD',
  MAIN_POINTS = 'MAIN_POINTS',
  TALKS = 'TALKS',
  SHEPHERDING = 'SHEPHERDING',
  STARTS = 'STARTS',
  DETAIL = 'DETAIL'
}

export type Language = 'el' | 'en' | 'es' | 'it';
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3000,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});

<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# Run and deploy your AI Studio app

This contains everything you need to run your app locally.

View your app in AI Studio: https://ai.studio/apps/drive/1H0ZoL_xubq2CIWuQimb3jCXYD5_D9ffX

## Run Locally

**Prerequisites:**  Node.js


1. Install dependencies:
   `npm install`
2. Set the `GEMINI_API_KEY` in [.env.local](.env.local) to your Gemini API key
3. Run the app:
   `npm run dev`

GEMINI_API_KEY=PLACEHOLDER_API_KEY

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



import React, { useState, useEffect, useCallback, useRef } from 'react';
import Sidebar from './components/Sidebar';
import Dashboard from './components/Dashboard';
import AddDataForm from './components/AddDataForm';
import Feed from './components/Feed';
import DetailView from './components/DetailView';
import { AppView, PersonalDataEntry, Language, Assignment } from './types';
import { translations } from './translations';

const App: React.FC = () => {
  const [language, setLanguage] = useState<Language>('el');
  const [currentView, setCurrentView] = useState<AppView>(AppView.DASHBOARD);
  const [entries, setEntries] = useState<PersonalDataEntry[]>([]);
  const [assignments, setAssignments] = useState<Assignment[]>([]);
  const [selectedEntryId, setSelectedEntryId] = useState<string | null>(null);
  const [appIcon, setAppIcon] = useState<string | null>(null);
  const [appBackground, setAppBackground] = useState<string | null>(null);
  const [saveStatus, setSaveStatus] = useState<'saved' | 'saving' | 'error'>('saved');

  const t = translations[language];
  const initialLoadDone = useRef(false);

  // Load everything from local storage on mount
  useEffect(() => {
    const saved = localStorage.getItem('omnivault_data');
    const savedAssignments = localStorage.getItem('omnivault_assignments');
    const savedLang = localStorage.getItem('omnivault_lang');
    const savedIcon = localStorage.getItem('omnivault_icon');
    const savedBg = localStorage.getItem('omnivault_bg');
    
    if (saved) {
      try {
        setEntries(JSON.parse(saved));
      } catch (e) { console.error("Entries storage corrupt", e); }
    }
    if (savedAssignments) {
      try {
        setAssignments(JSON.parse(savedAssignments));
      } catch (e) { console.error("Assignments storage corrupt", e); }
    }
    if (savedLang) {
      setLanguage(savedLang as Language);
    }
    if (savedIcon) {
      setAppIcon(savedIcon);
    }
    if (savedBg) {
      setAppBackground(savedBg);
    }
    
    setTimeout(() => {
      initialLoadDone.current = true;
    }, 100);
  }, []);

  const safeSave = useCallback((key: string, value: string) => {
    if (!initialLoadDone.current) return;
    if (localStorage.getItem(key) === value) return;

    setSaveStatus('saving');
    try {
      localStorage.setItem(key, value);
      setTimeout(() => setSaveStatus('saved'), 500);
    } catch (e) {
      console.error("Storage Error:", e);
      setSaveStatus('error');
      if (e instanceof DOMException && e.name === 'QuotaExceededError') {
        alert(t.alerts.storageFull);
      }
    }
  }, [t.alerts.storageFull]);

  // Persistence Effects
  useEffect(() => { if (initialLoadDone.current) safeSave('omnivault_data', JSON.stringify(entries)); }, [entries, safeSave]);
  useEffect(() => { if (initialLoadDone.current) safeSave('omnivault_assignments', JSON.stringify(assignments)); }, [assignments, safeSave]);
  useEffect(() => { if (initialLoadDone.current) safeSave('omnivault_lang', language); }, [language, safeSave]);
  useEffect(() => { if (initialLoadDone.current && appIcon) safeSave('omnivault_icon', appIcon); }, [appIcon, safeSave]);
  useEffect(() => {
    if (initialLoadDone.current) {
      if (appBackground) safeSave('omnivault_bg', appBackground);
      else if (appBackground === null && localStorage.getItem('omnivault_bg')) {
        setSaveStatus('saving');
        localStorage.removeItem('omnivault_bg');
        setTimeout(() => setSaveStatus('saved'), 500);
      }
    }
  }, [appBackground, safeSave]);

  const handleEntryClick = (entry: PersonalDataEntry) => {
    setSelectedEntryId(entry.id);
    setCurrentView(AppView.DETAIL);
  };

  const handleBackToDashboard = () => {
    setCurrentView(AppView.DASHBOARD);
    setSelectedEntryId(null);
  };

  const handleAddEntry = (entry: PersonalDataEntry) => setEntries(prev => [entry, ...prev]);
  const handleUpdateEntry = (id: string, newContent: string) => setEntries(prev => prev.map(entry => entry.id === id ? { ...entry, rawContent: newContent } : entry));
  const handleDeleteEntry = (id: string) => setEntries(prev => prev.filter(entry => entry.id !== id));
  
  const handleAddAssignment = (a: Assignment) => setAssignments(prev => [...prev, a]);
  const handleDeleteAssignment = (id: string) => setAssignments(prev => prev.filter(a => a.id !== id));

  const filterByKeywords = (keywords: string[]) => entries.filter(e => keywords.some(k => e.category.toLowerCase().includes(k.toLowerCase())) || keywords.some(k => e.rawContent.toLowerCase().includes(k.toLowerCase())));

  const BackButton = () => (
    <button 
      onClick={handleBackToDashboard}
      className="mb-8 flex items-center gap-2 text-slate-400 hover:text-white transition-colors group"
    >
      <div className="p-2 bg-slate-800 rounded-xl group-hover:bg-indigo-600 transition-all border border-slate-700">
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </div>
      <span className="font-bold text-sm uppercase tracking-widest">{language === 'el' ? 'Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î— Î£Î¤Î—Î Î‘Î¡Î§Î™ÎšÎ—' : language === 'es' ? 'VOLVER AL INICIO' : 'BACK TO HOME'}</span>
    </button>
  );

  const renderCategorizedPage = (keywords: string[], titleKey: string, descKey: string, placeholderKey: string, categoryHint: string) => {
    const filtered = filterByKeywords(keywords);
    const categoryTitle = (t.dashboard.categories as any)[titleKey] || (t.nav as any)[titleKey];
    
    return (
      <div className="space-y-6 animate-in fade-in duration-500">
        <BackButton />
        <AddDataForm 
          onEntryAdded={handleAddEntry} 
          onEntryUpdated={handleUpdateEntry}
          onEntryDeleted={handleDeleteEntry}
          onEntryClick={handleEntryClick}
          language={language} 
          entries={filtered}
          title={categoryTitle}
          description={descKey}
          placeholder={placeholderKey}
          categoryHint={categoryHint}
        />
        <div className="mt-20">
          <div className="flex items-center gap-6 mb-12">
            <h3 className="text-xl font-black text-white uppercase tracking-widest">{language === 'el' ? 'Î™Î£Î¤ÎŸÎ¡Î™ÎšÎŸ Î•ÎÎŸÎ¤Î—Î¤Î‘Î£' : 'SECTION HISTORY'}</h3>
            <div className="h-[2px] flex-1 bg-slate-700/50"></div>
          </div>
          <Feed 
            entries={filtered} 
            language={language} 
            onEntryClick={handleEntryClick}
            onEntryUpdated={handleUpdateEntry}
            onEntryDeleted={handleDeleteEntry}
          />
        </div>
      </div>
    );
  };

  const renderContent = () => {
    if (currentView === AppView.DETAIL && selectedEntryId) {
      const entry = entries.find(e => e.id === selectedEntryId);
      if (entry) return <DetailView entry={entry} language={language} onBack={handleBackToDashboard} />;
    }

    switch (currentView) {
      case AppView.DASHBOARD:
        return (
          <Dashboard 
            data={entries} 
            assignments={assignments}
            onAddAssignment={handleAddAssignment}
            onDeleteAssignment={handleDeleteAssignment}
            language={language} 
            onViewChange={setCurrentView} 
            onLanguageChange={setLanguage} 
          />
        );
      
      case AppView.MAIN_POINTS:
        return renderCategorizedPage(['ÎµÎ´Î¬Ï†Î¹Î¿', 'verse', 'versÃ­culo', 'ÎºÏÏÎ¹Î± ÏƒÎ·Î¼ÎµÎ¯Î±', 'main points'], 'verses', t.add.desc, t.add.placeholder, "Verse");
      
      case AppView.TALKS:
        return renderCategorizedPage(['Ï€ÎµÏ„ÏÎ¬Î´Î¹', 'gem', 'gema', 'Î¿Î¼Î¹Î»Î¯Î±', 'talk', 'discurso'], 'gem', t.add.desc, "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… Ï€Î½ÎµÏ…Î¼Î±Ï„Î¹ÎºÎ¿Ï Ï€ÎµÏ„ÏÎ±Î´Î¹Î¿Ï...", "Gem");
      
      case AppView.SHEPHERDING:
        return renderCategorizedPage(['Î¼ÎµÎ»Î­Ï„Î·', 'study', 'estudio', 'Ï€Î¿Î¹Î¼Î±Î½Ï„Î¹ÎºÎ®', 'shepherding', 'pastoreo'], 'study', t.add.desc, "Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ®Ï‚ Î¼ÎµÎ»Î­Ï„Î·Ï‚...", "Study");

      case AppView.STARTS:
        return renderCategorizedPage(['Î¾ÎµÎºÎ¯Î½Î·Î¼Î±', 'start', 'introduction', 'Ï€ÏÏŒÎ»Î¿Î³Î¿Ï‚', 'comienzo', 'ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®'], 'starts', t.add.desc, "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… Î¾ÎµÎºÎ¹Î½Î®Î¼Î±Ï„Î¿Ï‚ Î® ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚...", "Starts");

      default:
        return (
          <Dashboard 
            data={entries} 
            assignments={assignments}
            onAddAssignment={handleAddAssignment}
            onDeleteAssignment={handleDeleteAssignment}
            language={language} 
            onViewChange={setCurrentView} 
            onLanguageChange={setLanguage} 
          />
        );
    }
  };

  const getHeaderTitle = () => {
    switch (currentView) {
      case AppView.DASHBOARD: return t.nav.dashboard;
      case AppView.MAIN_POINTS: return t.nav.mainPoints;
      case AppView.TALKS: return t.nav.talks;
      case AppView.SHEPHERDING: return t.nav.shepherding;
      case AppView.STARTS: return t.nav.starts;
      case AppView.DETAIL: return language === 'el' ? 'Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚' : language === 'es' ? 'Detalles' : 'Details';
      default: return "";
    }
  };

  return (
    <div className="flex h-screen bg-[#0f172a] text-slate-200 overflow-hidden font-sans relative">
      {appBackground && (
        <div className="fixed inset-0 z-0 bg-cover bg-center transform-gpu" style={{ backgroundImage: `url(${appBackground})` }}>
          <div className="absolute inset-0 bg-slate-950/20" />
        </div>
      )}

      <Sidebar 
        currentView={currentView} 
        onViewChange={setCurrentView} 
        language={language}
        onLanguageChange={setLanguage}
        customIcon={appIcon}
        onIconChange={(b) => setAppIcon(b)}
        onBackgroundChange={(b) => setAppBackground(b)}
        hasBackground={!!appBackground}
        onExport={() => {
          const data = { entries, assignments, appIcon, appBackground, language };
          const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
          a.click();
        }}
        onImport={(json) => {
          try {
            const data = JSON.parse(json);
            if (data.entries) setEntries(data.entries);
            if (data.assignments) setAssignments(data.assignments);
            if (data.appIcon) setAppIcon(data.appIcon);
            if (data.appBackground) setAppBackground(data.appBackground);
            if (data.language) setLanguage(data.language);
            alert(t.alerts.importSuccess);
          } catch (e) { alert(t.alerts.importError); }
        }}
      />
      
      <main className="flex-1 h-screen overflow-y-auto relative scroll-smooth z-10">
        <header className="sticky top-0 z-30 bg-slate-900/60 border-b border-slate-800/50 px-8 py-4 flex items-center justify-between backdrop-blur-md">
          <div className="flex items-center gap-4">
            <h1 className="text-xl font-bold text-white drop-shadow-md">{getHeaderTitle()}</h1>
            {saveStatus === 'saving' && <span className="text-[10px] font-bold text-indigo-400 bg-indigo-500/10 px-2 py-0.5 rounded-full animate-pulse border border-indigo-500/20">{t.header.saving}</span>}
            {saveStatus === 'saved' && <span className="text-[10px] font-bold text-emerald-400 bg-emerald-500/10 px-2 py-0.5 rounded-full border border-emerald-500/20">{t.header.saved}</span>}
          </div>
          <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 border-2 border-slate-700 shadow-lg" />
        </header>

        <div className="p-8 max-w-7xl mx-auto">
          {renderContent()}
        </div>
      </main>
    </div>
  );
};

export default App;

<!DOCTYPE html>
<html lang="el">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎœÎµÎ»Î­Ï„Î· - Personal AI Knowledge Base</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ““</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0f172a;
        color: #f8fafc;
      }
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #1e293b;
      }
      ::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "recharts": "https://esm.sh/recharts@^3.7.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.38.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="index.tsx"></script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>

import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

{
  "name": "Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎœÎµÎ»Î­Ï„Î·",
  "description": "A sophisticated personal data engine that organizes, categorizes, and provides insights into your personal life using Gemini's advanced reasoning.",
  "requestFramePermissions": [
    "camera"
  ]
}
[build]
  publish = "."

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Cache-Control = "public, max-age=0, must-revalidate"
